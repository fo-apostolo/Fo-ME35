from machine import Pin, ADC
import time
import math
import LED
import sc
from secrets import Tufts_eecs as wifi
import mqtt_CBR

# declaring all of the angles which were calculated in MATLAB
theta1 = [-158.814703395802,-161.891193748308,-165.041341172963,-169.035750136063,-174.165896708122,-179.532649267277,-185.329897120308,-188.795055810913,-191.510216644558,-193.817759162650,-196.214657217129,-198.284496942886,-200.098198080524,-201.005180211380,-201.421585925717,-200.532062771269,-199.254040397111,-197.500510095007,-195.304873161393,-191.929057132361,-90.3832991309269,-88.9638208450626,-88.0190145962386,-87.5768372200721,-88.1279420257465,-89.8041588753605,-99.1113736170264,-105.419196712909,-110.865596714649,-116.658647222651,-122.613823627517,-129.358614402283,-137.429146008645,-143.848731288432,-150.891315346787,-162.957213142752,-168.712152898915,-173.925282158160,-178.630659153598,-183.926294968512]
theta2 = [52.4025508407758,53.6152277818011,55.2243794698327,57.8042713043393,61.8976796882221,66.9116724611228,77.4084543586333,83.9881535515276,89.3392828527063,94.5100406496196,99.6844823962607,104.962004602295,110.643553788496,114.687143756847,118.653110062768,124.306638000726,126.473676106131,128.110202632435,129.276742094929,130.157416603401,52.4025508407758,53.6152277818011,55.2243794698327,57.8042713043393,61.8976796882221,66.9116724611228,77.4084543586333,83.9881535515276,89.3392828527063,94.5100406496196,99.6844823962607,104.962004602295,110.643553788496,114.687143756847,118.653110062768,124.306638000726,126.473676106131,128.110202632435,129.276742094929,130.157416603401]
    
# setting up the connection
mqtt_broker = '10.245.___.__' 
topic_sub = 'angles'
topic_pub = 'angles'
client_id = 'Fo'

mqtt_CBR.connect_wifi(wifi)
fred.connect(mqtt_broker)

# turns on the LED
led = machine.Pin(2, machine.Pin.OUT)  # 6 for 2040

# prep for loop
i = 0

# sends the angle to the broker
def main():
    fred = mqtt_CBR.mqtt_client(client_id, mqtt_broker, whenCalled)
    fred.subscribe(topic_sub)

    fred.publish(topic_pub, '('+theta1[i]+','theta2[i]+')')
    time.sleep(.5)
    i = i + 1

# loops through all of the angles
for i in range(40):
    main()
    time.sleep(.25)
    
